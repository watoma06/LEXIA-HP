# ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
# ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
name: ğŸ”§ Simple Deploy (Backup)

on:
  push:
    branches: ["main"]
    # ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ãŸå ´åˆã®ã¿å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      force_deploy:
        description: 'å¼·åˆ¶ãƒ‡ãƒ—ãƒ­ã‚¤'
        required: false
        default: 'false'
        type: choice
        options:
          - 'false'
          - 'true'  # ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å¤±æ•—ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦è¿½åŠ 
  workflow_run:
    workflows: ["ğŸš€ Deploy LEXIA-HP Website"]
    types:
      - completed
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages-${{ github.event_name }}"
  cancel-in-progress: true

jobs:
  simple-deploy:
    name: ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    # ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ãŸå ´åˆã¾ãŸã¯æ‰‹å‹•å®Ÿè¡Œã®å ´åˆã®ã¿å®Ÿè¡Œ
    if: >
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure') ||
      (github.event_name == 'push' && github.event.head_commit.message contains '[backup-deploy]')
    steps:
      - name: ğŸ“Š å®Ÿè¡Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯
        run: |
          echo "ğŸ” å®Ÿè¡Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯:"
          echo "Event: ${{ github.event_name }}"
          if [ "${{ github.event_name }}" == "workflow_run" ]; then
            echo "ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµæœ: ${{ github.event.workflow_run.conclusion }}"
          fi
          if [ "${{ github.event_name }}" == "push" ]; then
            echo "ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${{ github.event.head_commit.message }}"
          fi
          echo "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã—ã¾ã™..."
      - name: ğŸ“¦ Checkout
        uses: actions/checkout@v4
        
      - name: ğŸ› ï¸ Pagesè¨­å®š
        uses: actions/configure-pages@v5
        
      - name: ğŸ“¤ ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
            - name: ğŸš€ GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤
        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
        run: |
          echo "ğŸ‰ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†!"
          echo "URL: ${{ steps.deployment.outputs.page_url }}"
          echo "å®Ÿè¡Œç†ç”±: ${{ github.event_name }}"
          if [ "${{ github.event_name }}" == "workflow_run" ]; then
            echo "âš ï¸ ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å¤±æ•—ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã—ãŸ"
          fi
          
      - name: ğŸš¨ å¤±æ•—æ™‚é€šçŸ¥
        if: failure()
        run: |
          echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "æ‰‹å‹•ã§ã®ç¢ºèªãŒå¿…è¦ã§ã™"
          exit 1
